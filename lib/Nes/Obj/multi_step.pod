
=head1 NAME

multi_step.nhtml - Secure Multi Step Form.

=head1 SYNOPSIS

Send data over a script handler:

    {: include ('{: * cfg_obj_top_dir :}/Nes/form/multi_step.nhtml',
                "
                  script_handler   => 'my_script_handler.pl',
                  function_handler => 'my_function_handler',
                  form_name        => 'my_form_1',

                  steps  => {: # steps  :}
                      [     
                        [   {: # step 1 :}
                          { {: # field 1 for step 1 :}
                            name     => 'name', 
                            msg      => 'The \"Name\"',
                            type     => 'text',
                            size     => 12,
                            {: # check 4 min, 22 max, begins with a 
                            letter, alphanumeric :} 
                            check    => '4,22,/^[a-zA-Z]\w*$/',
                          },
                          { {: # field 2 for step 1 :}
                            name     => 'email', 
                            msg      => 'Email Address',
                            type     => 'tex',
                            size     => 12,
                            check    => '8,40,/[\w-]+@([\w-]+\.)+[\w-]+/i',
                          },
                            {: # more fields for stept 1 ... :}
                        ],
                        [   {: # step 2 :}
                          { {: # field 1 for step 2 :}
                            name     => 'message', 
                            msg      => 'Message',
                            type     => 'textarea',
                            filter   => 'yes_tag_B,yes_tag_BR,yes_tag_I',
                            cols     => 20,
                            rows     => 6,
                          },
                            {: # more fields for step 2 ... :}
                        ],                                
                            {: #  more steps ... :}                                              
                      ],
                "
               )         
    :}

Insert data directly to the database:

    {: include ('{: * cfg_obj_top_dir :}/Nes/form/multi_step.nhtml',
                "
                  to_database        => 'INSERT',
                  to_table           => 'table',
                  to_fields_assort   => 
                         {
                           name      => 'name',
                         },   

                  {: # steps ... :}
                "
               )         
    :}

Update data directly to the database:

    {: include ('{: * cfg_obj_top_dir :}/Nes/form/multi_step.nhtml',
                "
                  to_database        => 'UPDATE',
                  to_table           => 'table',
                  to_where           => '',
                  to_limit           => '',                  
                  to_fields_assort   => 
                         {
                           name      => 'name',
                         },   

                  {: # steps ... :}
                "
               )         
    :}

=head1 DESCRIPTION

Create a form with one or more steps, with a captcha at the end. Data can be 
sent over a script handler or directly to the database.

=head1 PARAMETERS

=over 2

=item script_handler

The script that contains the "function_handler"

=item function_handler

Function that receives the form data.

=item script_NES

Perl script to execute.

=item to_database

INSERT or UPDATE database.

=item to_table

Table name to insert or update.

=item to_where

WHERE clause in sql sentence in UPDATE mode.

=item to_limit

LIMIT clause in sql sentence in UPDATE mode.

=item to_fields_assort

Correspondence from the fields of the database to form.
   
=item msg_error_data

Text to show if error data.

=item msg_ok_data

Text to show if success data.

=item referer

Check referer.

=item private_key

Private key to crypt data.

=item show_captcha

1 show captcha, 0 not

=item table_width

Width table form.

=item submit_begin

=item submit_end

=item span_error

=item form_expire

=item form_name

=item captcha_name

Tag name property of captcha.

=item captcha_type

ascii.

=item captcha_digits

Digit number captcha.

=item captcha_size

Captcha size.

=item captcha_noise

Captcha noise level.

=item captcha_sig

Character to the foreground

=item captcha_spc

Character to the background

=item captcha_expire

Time to expire captcha. Default '40s' one minute. Time suffix: 
s: seconds, m: minutes h: hours d: days, M: months, y: years. 

=item captcha_end

=item captcha_begin

=item captcha_atempts

Attempts/minutes, if we reach attempts, wait the time shown in "minutes". 
Default is '10/5'

=item captcha_tag_start

HTML Tag for the design of the captcha.

=item captcha_tag_end

HTML Tag for the design of the captcha.

=item out_page

Out page. Default self.

=item msg_legend

Text to show in lengend tag.

=item msg_submit

Text to show in send button.

=item msg_captcha

Text to show in captcha field.

=item txt_captcha

=item msg_error_captcha

=item msg_error_form
                             
=item id_form

=item class_form

=item action_form

=item tpl_errors

=item tpl_options

=item msg_error_fields


=back

=head1 BUGS

Not support "multiple select".

=head1 AUTHOR

Skriptke: Enrique F. Castanon

=head1 VERSION

Version 1.00 Febrero 2010

=head1 COPYRIGHT

Copyright (c) Enrique F. Castanon Barbero. All rights reserved.

=head1 LICENSE

This program is free software; you can redistribute it
and/or modify it under the same terms and conditions as
GNU Public License (GPL).

This means that you can, at your option, redistribute it and/or 
modify it under either the terms the GNU Public License (GPL), 
or under the Perl Artistic License.

See http://dev.perl.org/licenses/

=head1 DISCLAIMER

THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS
OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE.

Use of this software in any way or in any form, source or binary,
is not allowed in any country which prohibits disclaimers of any
implied warranties of merchantability or fitness for a particular
purpose or any disclaimers of a similar nature.

IN NO EVENT SHALL I BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
SPECIAL, INCIDENTAL,  OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
USE OF THIS SOFTWARE AND ITS DOCUMENTATION (INCLUDING, BUT NOT
LIMITED TO, LOST PROFITS) EVEN IF I HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE

=head1 SEE ALSO

L<Nes>, L<Nes::Tutorial>, L<Nes::nes.cfg>

=cut

